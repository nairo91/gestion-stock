<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>QR-codes des racks — Impression A4</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --gap: 14mm; /* écart horizontal/vertical */
      --cols: 3;   /* 3 colonnes par ligne en A4 portrait */
    }
    @page {
      size: A4 portrait;
      margin: 12mm;
    }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: #111;
      margin: 0;
      padding: 0;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8mm 0 4mm;
      border-bottom: 1px solid #ddd;
      margin-bottom: 6mm;
    }
    h1 {
      font-size: 16pt;
      margin: 0;
    }
    .actions {
      display: flex;
      gap: 8px;
    }
    .btn {
      appearance: none;
      border: 1px solid #999;
      background: #fff;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 11pt;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(var(--cols), 1fr);
      gap: var(--gap);
      align-items: start;
    }
    .card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 6mm 6mm 5mm;
      text-align: center;
      break-inside: avoid;
      page-break-inside: avoid;
      background: #fff;
    }
    .name {
      font-weight: 700;
      font-size: 12pt;
      margin: 0 0 4mm;
    }
    .qr-wrap {
      display: flex;
      justify-content: center;
      align-items: center;
      background: #fff;
      padding: 4mm;
      border: 1px dashed #ccc;
      border-radius: 6px;
    }
    .qr {
      width: 42mm;  /* taille confortable lisible à ~1m */
      height: 42mm;
      object-fit: contain;
    }
    .url {
      margin-top: 3mm;
      font-size: 8.5pt;
      color: #444;
      word-break: break-all;
    }
    .hint {
      margin-top: 2mm;
      font-size: 9pt;
      color: #555;
    }
    @media print {
      .no-print { display: none !important; }
      header { border: none; margin: 0 0 4mm; padding: 0; }
    }
  </style>
</head>
<body>
  <header class="no-print">
    <h1>QR-codes des racks (A4)</h1>
    <div class="actions">
      <a class="btn" href="/materiel/racks/qr">Vue cartes</a>
      <button class="btn" onclick="window.print()">Imprimer</button>
    </div>
  </header>

  <main>
    <div class="grid">
      <% racks.forEach(r => { %>
        <div class="card">
          <div class="name"><%= r %></div>
          <div class="qr-wrap">
            <img
              class="qr"
              alt="QR <%= r %>"
              src="/materiel/rack/<%= encodeURIComponent(r) %>/qr"
            />
          </div>
          <div class="hint">Scannez pour ouvrir l’inventaire filtré :</div>
          <div class="url"><%= `${req.protocol}://${req.get('host')}/materiel?rack=${encodeURIComponent(r)}` %></div>
        </div>
      <% }) %>
    </div>
  </main>
</body>
</html>
